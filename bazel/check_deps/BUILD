# Part of the Carbon Language project, under the Apache License v2.0 with LLVM
# Exceptions. See /LICENSE for license information.
# SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception

# The filegroups establishing root rules for `genquery` invocations can be updaated by running:
#
# ```
# ./bazel/check_deps/update_roots.py
# ```

# This filegroup should contain all the non-test C++ rules in the repository to
# enable dependency checking. It can be regenerated by running the following
# query command:
#
# ```
# bazelisk query 'kind("cc.* rule", attr(testonly, 0, //...))'
# ```
filegroup(
    name = "non_test_cc_rules",
    data = [
        "//executable_semantics",
        "//migrate_cpp/cpp_refactoring",
        "//toolchain/diagnostics:null_diagnostics",
        "//toolchain/driver:carbon",
    ],
)

genquery(
    name = "non_test_cc_deps.txt",
    expression = "kind('cc.* rule', deps(//bazel/check_deps:non_test_cc_rules))",
    opts = [
        "--notool_deps",
        "--noimplicit_deps",
    ],
    scope = [":non_test_cc_rules"],
)

py_test(
    name = "check_non_test_cc_deps",
    srcs = ["check_non_test_cc_deps.py"],
    data = [":non_test_cc_deps.txt"],
    main = "check_non_test_cc_deps.py",
)
