; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc -verify-machineinstrs < %s -mtriple=powerpc64le-unknown-linux-gnu | FileCheck %s

@lens = external global i8*             ; <i8**> [#uses=1]
@vals = external global i32*            ; <i32**> [#uses=1]

define i32 @test(i32 %i) {
; CHECK-LABEL: test:
; CHECK:       # %bb.0:
; CHECK-NEXT:    addis 4, 2, .LC0@toc@ha
; CHECK-NEXT:    extsw 3, 3
; CHECK-NEXT:    addis 5, 2, .LC1@toc@ha
; CHECK-NEXT:    ld 4, .LC0@toc@l(4)
; CHECK-NEXT:    ld 4, 0(4)
; CHECK-NEXT:    lbzx 3, 4, 3
; CHECK-NEXT:    ld 4, .LC1@toc@l(5)
; CHECK-NEXT:    subfic 3, 3, 1
; CHECK-NEXT:    ld 4, 0(4)
; CHECK-NEXT:    extsw 3, 3
; CHECK-NEXT:    sldi 3, 3, 2
; CHECK-NEXT:    lwzx 3, 4, 3
; CHECK-NEXT:    blr
  %tmp = load i8*, i8** @lens          ; <i8*> [#uses=1]
  %tmp1 = getelementptr i8, i8* %tmp, i32 %i          ; <i8*> [#uses=1]
  %tmp.upgrd.1 = load i8, i8* %tmp1           ; <i8> [#uses=1]
  %tmp2 = zext i8 %tmp.upgrd.1 to i32             ; <i32> [#uses=1]
  %tmp3 = load i32*, i32** @vals                ; <i32*> [#uses=1]
  %tmp5 = sub i32 1, %tmp2                ; <i32> [#uses=1]
  %tmp6 = getelementptr i32, i32* %tmp3, i32 %tmp5             ; <i32*> [#uses=1]
  %tmp7 = load i32, i32* %tmp6         ; <i32> [#uses=1]
  ret i32 %tmp7
}

