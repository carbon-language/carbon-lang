// Part of the Carbon Language project, under the Apache License v2.0 with LLVM
// Exceptions. See /LICENSE for license information.
// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception

// Test the way in which copying of continuations interacts with data
// on the stack such as the variable `x`. The copy of the continuation
// happens after the variable `x` is created, so both continuations
// refer to the same `x`. The first continuation finishes and deallocates
// `x`, then the second continuation finishes and tries to deallocate
// `x` again, which is a runtime error.

fn main() -> Int {
  __continuation k1 {
    var Int: x = 0;
    __await;
  }
  __run k1;
  var __Continuation: k2 = k1;
  __run k1;
  __run k2;
  return 0;
}
