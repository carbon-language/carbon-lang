// Part of the Carbon Language project, under the Apache License v2.0 with LLVM
// Exceptions. See /LICENSE for license information.
// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception

// Test that `__resume` does not mutate a continuation, so
// resuming the same continuation twice returns to the same
// point in the continuation each time.

fn main() -> Int {
  var Int: x = 0;

  __delimit {
    __yield 0;
    __yield 1;
    __yield 2;
  } __catch (_,k) {
    __delimit {
      __resume k;
    } __catch (v1,_) {
      x = x + v1;
      __delimit {
        __resume k;
      } __catch (v2,_) {
        x = x + v2;
      }
    }
  }
  return x;
}
