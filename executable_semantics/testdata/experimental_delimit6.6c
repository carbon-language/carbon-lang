// Part of the Carbon Language project, under the Apache License v2.0 with LLVM
// Exceptions. See /LICENSE for license information.
// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception

// Test the way in which copying of continuations interacts with state
// such as the variable `x`.

fn f(__Continuation: s1, __Continuation: s2) -> Int {
  __delimit {
    __resume s1;
  } __catch (v, s) {
  }

  __delimit {
    __resume s2;
  } __catch (v, s) {
    return v;
  }
}

fn main() -> Int {
  __delimit {
    var Int: x = 0;
    while(true) {
      __yield x;
      x = x + 1;
    }
    return -1;
  } __catch (_, s) {
    return f(s, s);
  }
}
