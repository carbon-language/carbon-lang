; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; RUN: opt < %s -indvars -adce -simplifycfg -S | FileCheck %s
; PR1598

define i32 @f(i32 %a, i32 %b, i32 %x, i32 %y) {
; CHECK-LABEL: @f(
; CHECK-NEXT:  entry:
; CHECK-NEXT:    [[TMP3:%.*]] = icmp eq i32 [[A:%.*]], [[B:%.*]]
; CHECK-NEXT:    [[TMP0:%.*]] = add i32 [[X:%.*]], 1
; CHECK-NEXT:    [[SMAX:%.*]] = call i32 @llvm.smax.i32(i32 [[Y:%.*]], i32 [[TMP0]])
; CHECK-NEXT:    [[X_ADDR_1:%.*]] = select i1 [[TMP3]], i32 [[X]], i32 [[SMAX]]
; CHECK-NEXT:    ret i32 [[X_ADDR_1]]
;
entry:
  %tmp3 = icmp eq i32 %a, %b		; <i1> [#uses=1]
  br i1 %tmp3, label %return, label %bb

bb:		; preds = %bb, %entry
  %x_addr.0 = phi i32 [ %tmp6, %bb ], [ %x, %entry ]		; <i32> [#uses=1]
  %tmp6 = add i32 %x_addr.0, 1		; <i32> [#uses=3]
  %tmp9 = icmp slt i32 %tmp6, %y		; <i1> [#uses=1]
  br i1 %tmp9, label %bb, label %return

return:		; preds = %bb, %entry
  %x_addr.1 = phi i32 [ %x, %entry ], [ %tmp6, %bb ]		; <i32> [#uses=1]
  ret i32 %x_addr.1
}
