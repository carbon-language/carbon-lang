; NOTE: Assertions have been autogenerated by update_test_checks.py
; Test merging of blocks that only have PHI nodes in them
;
; RUN: opt < %s -simplifycfg -simplifycfg-require-and-preserve-domtree=1 -S | FileCheck %s
;

define i32 @test(i1 %a, i1 %b) {
; CHECK-LABEL: @test(
; CHECK:       M:
; CHECK-NEXT:    [[DOT:%.*]] = select i1 %b, i32 0, i32 1
; CHECK-NEXT:    [[W:%.*]] = select i1 %a, i32 2, i32 [[DOT]]
; CHECK-NEXT:    [[R:%.*]] = add i32 [[W]], 1
; CHECK-NEXT:    ret i32 [[R]]
;
  br i1 %a, label %M, label %O
O:              ; preds = %0
  br i1 %b, label %N, label %Q
Q:              ; preds = %O
  br label %N
N:              ; preds = %Q, %O
  ; This block should be foldable into M
  %Wp = phi i32 [ 0, %O ], [ 1, %Q ]              ; <i32> [#uses=1]
  br label %M
M:              ; preds = %N, %0
  %W = phi i32 [ %Wp, %N ], [ 2, %0 ]             ; <i32> [#uses=1]
  %R = add i32 %W, 1              ; <i32> [#uses=1]
  ret i32 %R
}

