; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; RUN: opt -S -mergeicmps < %s | FileCheck %s

; This does not use a GEP for the zero-offset comparison and requires a
; split for other work.

target triple = "x86_64-grtev4-linux-gnu"

declare void @other_work()

define i1 @test(i8* dereferenceable(2) %arg, i8* dereferenceable(2) %arg1) {
; CHECK-LABEL: @test(
; CHECK-NEXT:  "if+entry":
; CHECK-NEXT:    call void @other_work()
; CHECK-NEXT:    [[MEMCMP:%.*]] = call i32 @memcmp(i8* [[ARG:%.*]], i8* [[ARG1:%.*]], i64 2)
; CHECK-NEXT:    [[TMP0:%.*]] = icmp eq i32 [[MEMCMP]], 0
; CHECK-NEXT:    br label [[JOIN:%.*]]
; CHECK:       join:
; CHECK-NEXT:    ret i1 [[TMP0]]
;
entry:
  call void @other_work()
  %arg.off = getelementptr inbounds i8, i8* %arg, i64 1
  %arg1.off = getelementptr inbounds i8, i8* %arg1, i64 1
  %arg.off.val = load i8, i8* %arg.off
  %arg1.off.val = load i8, i8* %arg1.off
  %cmp.off = icmp eq i8 %arg.off.val, %arg1.off.val
  br i1 %cmp.off, label %if, label %join

if:
  %arg.val = load i8, i8* %arg
  %arg1.val = load i8, i8* %arg1
  %cmp = icmp eq i8 %arg.val, %arg1.val
  br label %join

join:
  %phi = phi i1 [ false, %entry ], [ %cmp, %if ]
  ret i1 %phi
}
