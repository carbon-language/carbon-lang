; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; RUN: opt -S -instcombine -opaque-pointers < %s | FileCheck %s

@g = global [16 x i16] zeroinitializer

define ptr @gep_constexpr_gv_1() {
; CHECK-LABEL: @gep_constexpr_gv_1(
; CHECK-NEXT:    ret ptr getelementptr inbounds ([16 x i16], ptr @g, i64 0, i64 10)
;
  ret ptr getelementptr([16 x i16], ptr @g, i64 0, i64 10)
}

define ptr @gep_constexpr_gv_2() {
; CHECK-LABEL: @gep_constexpr_gv_2(
; CHECK-NEXT:    ret ptr getelementptr inbounds ([16 x i16], ptr @g, i64 0, i64 12)
;
  ret ptr getelementptr(i32, ptr getelementptr([16 x i16], ptr @g, i64 0, i64 10), i64 1)
}

; Silly expression to get an inttoptr that does not combine with the GEP.
define ptr @gep_constexpr_inttoptr() {
; CHECK-LABEL: @gep_constexpr_inttoptr(
; CHECK-NEXT:    ret ptr getelementptr (i8, ptr inttoptr (i64 mul (i64 ptrtoint (ptr @g to i64), i64 2) to ptr), i64 20)
;
  ret ptr getelementptr([16 x i16], ptr inttoptr (i64 mul (i64 ptrtoint ([16 x i16]* @g to i64), i64 2) to ptr), i64 0, i64 10)
}
