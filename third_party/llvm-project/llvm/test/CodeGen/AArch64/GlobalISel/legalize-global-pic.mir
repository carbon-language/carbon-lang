# NOTE: Assertions have been autogenerated by utils/update_mir_test_checks.py
# RUN: llc -O0 -run-pass=legalizer --relocation-model=pic %s -o - | FileCheck %s --check-prefix=PIC

--- |
  target datalayout = "e-m:o-i64:64-i128:128-n32:64-S128"
  target triple = "aarch64--"
  @var = external global i8
  define i8* @test_global() { ret i8* undef }
  define i8* @test_global_with_offset() { ret i8* undef }
...
---
name:            test_global
registers:
  - { id: 0, class: _ }
body: |
  bb.0:

    ; We don't want to lower to G_ADD_LOW when we need a GOT access, or when the code
    ; model isn't 'Small'.

    ; PIC-LABEL: name: test_global
    ; PIC: [[GV:%[0-9]+]]:_(p0) = G_GLOBAL_VALUE @var
    ; PIC: [[PTRTOINT:%[0-9]+]]:_(s64) = G_PTRTOINT [[GV]](p0)
    ; PIC: $x0 = COPY [[PTRTOINT]](s64)
    %0(p0) = G_GLOBAL_VALUE @var
    %1:_(s64) = G_PTRTOINT %0
    $x0 = COPY %1
...
---
name:            test_global_with_offset
registers:
  - { id: 0, class: _ }
body: |
  bb.0:
    ; PIC-LABEL: name: test_global_with_offset
    ; PIC: [[GV:%[0-9]+]]:_(p0) = G_GLOBAL_VALUE @var + 1
    ; PIC: [[PTRTOINT:%[0-9]+]]:_(s64) = G_PTRTOINT [[GV]](p0)
    ; PIC: $x0 = COPY [[PTRTOINT]](s64)
    %0(p0) = G_GLOBAL_VALUE @var + 1
    %1:_(s64) = G_PTRTOINT %0
    $x0 = COPY %1
...
