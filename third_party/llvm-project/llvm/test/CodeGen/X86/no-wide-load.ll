; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc < %s -mtriple=x86_64-- -x86-promote-anyext-load=false | FileCheck %s

%struct.S = type { i32, i16, i16 }

define void @foo(%struct.S* %p, i16 signext %s) {
; CHECK-LABEL: foo:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    movzwl 4(%rdi), %eax
; CHECK-NEXT:    andl $-1121, %eax # imm = 0xFB9F
; CHECK-NEXT:    orl $1024, %eax # imm = 0x400
; CHECK-NEXT:    movw %ax, 4(%rdi)
; CHECK-NEXT:    retq
entry:
  %f2 = getelementptr inbounds %struct.S, %struct.S* %p, i64 0, i32 1
  %0 = load i16, i16* %f2, align 4
  %1 = and i16 %0, -1121
  %2 = or i16 %1, 1024
  store i16 %2, i16* %f2, align 4
  ret void
}

