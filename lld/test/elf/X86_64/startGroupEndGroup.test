# This tests functionality of --start-group, --end-group

# This link should fail with unresolve symbol
RUN: not lld -flavor gnu -target x86_64 %p/Inputs/group/1.o %p/Inputs/group/libfn.a \
RUN: %p/Inputs/group/libfn1.a -o x 2> %t.err

# Test group
RUN: lld -flavor gnu -target x86_64 %p/Inputs/group/1.o --start-group \
RUN: %p/Inputs/group/libfn.a %p/Inputs/group/libfn1.a --end-group -o %t1

# Mix object files in group
RUN: lld -flavor gnu -target x86_64 %p/Inputs/group/1.o --start-group \
RUN: %p/Inputs/group/fn.o %p/Inputs/group/fn2.o \
RUN: %p/Inputs/group/fn1.o --end-group -o %t2

# Mix Whole archive input, the group should not iterate the file libfn.a
RUN: lld -flavor gnu -target x86_64 %p/Inputs/group/1.o --start-group \
RUN: --whole-archive %p/Inputs/group/libfn.a --no-whole-archive %p/Inputs/group/libfn1.a --end-group -o %t3

RUN: FileCheck --check-prefix=UNRESOLVED %s < %t.err
RUN: llvm-nm %t1 | FileCheck -check-prefix=RESOLVEDEXTERNAL %s
RUN: llvm-nm %t2 | FileCheck -check-prefix=RESOLVEDEXTERNAL %s
RUN: llvm-nm %t3 | FileCheck -check-prefix=RESOLVEDEXTERNAL %s

UNRESOLVED: Undefined Symbol: {{[\/0-9A-Za-z_\-\.]+}}libfn1.a(fn1.o) : fn2

RESOLVEDEXTERNAL: {{[0-9a-z]+}} T fn2
