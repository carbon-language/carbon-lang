<!DOCTYPE html>
<!--
Part of the Carbon Language project, under the Apache License v2.0 with LLVM
Exceptions. See /LICENSE for license information.
SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
-->
<html>
  <head>
    <title>Carbon: Login</title>
    <script src="/__/firebase/7.14.0/firebase-app.js"></script>
    <script src="/__/firebase/7.14.0/firebase-auth.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="/static/firebase-init.js"></script>
    <script type="text/javascript">
      function postIdToken(idToken) {
        // POST to session login endpoint.
        return $.ajax({
          type: 'POST',
          url: '/loginSession',
          dataType: 'json',
          data: { idToken: idToken },
          contentType: 'application/x-www-form-urlencoded',
        });
      }

      function login() {
        var provider = new firebase.auth.GithubAuthProvider();
        firebase
          .auth()
          .signInWithPopup(provider)
          .then(function (result) {
            var user = result.user;
            user.getIdToken(true).then(function (idToken) {
              postIdToken(idToken).then(function (result) {
                window.location.href = window.location.href.replace(
                  '/login.html',
                  '/index.html'
                );
              });
            });
          });
      }

      window.onload = function () {
        document.cookie = '__session=; expires=Thu, 01 Jan 1970 00:00:00 GMT';
        firebase.auth().signOut();
      };
    </script>
  </head>
  <body>
    <p>Currently logged out.</p>

    <button onclick="login()">Log in using GitHub</button>
  </body>
</html>
