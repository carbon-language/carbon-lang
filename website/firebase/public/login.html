<!DOCTYPE html>
<!--
Part of the Carbon Language project, under the Apache License v2.0 with LLVM
Exceptions. See /LICENSE for license information.
SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
-->
<html>
  <head>
    <title>Carbon: Login</title>
    <script src="/__/firebase/7.14.0/firebase-app.js"></script>
    <script src="/__/firebase/7.14.0/firebase-auth.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="/static/firebase-init.js"></script>
    <script type="text/javascript">
      function postIdToken(idToken) {
        // POST to session login endpoint.
        return $.ajax({
          type: 'POST',
          url: '/loginSession',
          dataType: 'json',
          data: { idToken: idToken },
          contentType: 'application/x-www-form-urlencoded',
        });
      }

      function login() {
        document.getElementById('button').disabled = true;
        var provider = new firebase.auth.GithubAuthProvider();
        firebase
          .auth()
          .signInWithPopup(provider)
          .then(function (result) {
            document.getElementById('loader').className = 'loader';
            var user = result.user;
            user.getIdToken(true).then(function (idToken) {
              postIdToken(idToken).then(function (result) {
                window.location.href = window.location.href.replace(
                  '/login.html',
                  '/index.html'
                );
              });
            });
          });
      }

      window.onload = function () {
        document.cookie = '__session=; expires=Thu, 01 Jan 1970 00:00:00 GMT';
        firebase.auth().signOut();
      };
    </script>
    <style>
      .loader {
        border: 4px solid #f3f3f3;
        border-radius: 50%;
        border-top: 4px solid #3498db;
        width: 20px;
        height: 20px;
        -webkit-animation: spin 2s linear infinite; /* Safari */
        animation: spin 2s linear infinite;
      }

      /* Safari */
      @-webkit-keyframes spin {
        0% {
          -webkit-transform: rotate(0deg);
        }
        100% {
          -webkit-transform: rotate(360deg);
        }
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <p>Currently logged out.</p>

    <button id="button" onclick="login()">Log in using GitHub</button>

    <div id="loader"></div>
  </body>
</html>
