# Reviewer-merged PRs

<!--
Part of the Carbon Language project, under the Apache License v2.0 with LLVM
Exceptions. See /LICENSE for license information.
SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
-->

[Pull request](https://github.com/carbon-language/carbon-lang/pull/1190)

<!-- toc -->

## Table of contents

-   [Problem](#problem)
-   [Background](#background)
-   [Proposal](#proposal)
-   [Details](#details)
-   [Rationale](#rationale)
-   [Alternatives considered](#alternatives-considered)
    -   [Never merge PRs from developers with merge access](#never-merge-prs-from-developers-with-merge-access)
    -   [Grant all potential contributors merge access](#grant-all-potential-contributors-merge-access)

<!-- tocstop -->

## Problem

We've been having authors merged PRs, but that's not going to work when we get
contributors who don't have merge access. We need a solution.

## Background

It's been mentioned that LLVM favors having authors merge due to the risks of
breaking build bots. The LLVM community's leaning is to favor author merges so
that the author can decide whether to try rolling back or fixing forward.

At present Carbon has essentially been using a
[shared repository model](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/getting-started/about-collaborative-development-models#shared-repository-model)
where authors merge their own PRs, but that's difficult to extend to a fully
public setup. The
[fork and pull model](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/getting-started/about-collaborative-development-models#fork-and-pull-model)
is the other main git collaboration model, and is popular with open source
projects.

## Proposal

Encourage reviewers to merge when they feel okay doing so. Let reviewers make
that choice. Let authors say they'll merge themselves.

This is a
[fork and pull model](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/getting-started/about-collaborative-development-models#fork-and-pull-model)
which encourages reviewer merges.

## Details

See changes to [code review](/docs/project/code_review.md).

## Rationale

-   [Community and culture](/docs/project/goals.md#community-and-culture)
    -   Defines a process for accepting contributions from developers who don't
        have merge access.

## Alternatives considered

### Never merge PRs from developers with merge access

We could tell reviewers to never merge PRs from developers with merge access.
This is also a
[fork and pull model](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/getting-started/about-collaborative-development-models#fork-and-pull-model),
but minimizing reviewer merges.

Advantages:

-   While this proposal suggest authors could opt out from having the reviewer
    merge, minimizing reviewer merges avoids a gray area when an author forgets
    or the reviewer misses it (even if enforced, the author might do it wrong).

Disadvantages:

-   Relies on the reviewer figuring out whether the author has merge access,
    which they may forget to do. The most likely consequence is that outside
    contributors will need to ping to get PRs merged.
-   Makes reviewer merges less common. This in turn can make them less
    consistently done well due to unfamiliarity.

In the future, build bots may cause more issues, and we may lean more in this
direction. It could also be that we end up here through standard practice of
coordinating with the reviewer is concerned the author may need to fix a break
post-commit. However, it doesn't seem necessary to make it a hard rule at
present.

### Grant all potential contributors merge access

We could grant the public merge access; in other words, continue with a
[shared repository model](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/getting-started/about-collaborative-development-models#shared-repository-model),
but fully public instead of private. This way, reviewers would not need to
consider access.

Advantages:

-   Authors can always merge, removing the burden on reviewers.

Disadvantages:

-   Relies on approvals heavily for code security, which constrains decisions
    [regarding whether to keep CODEOWNERS](https://github.com/carbon-language/carbon-lang/issues/413).
-   This kind of setup is likely atypical for GitHub projects, and so may be
    more surprising than alternatives.
-   Harder for reviewers to discern between frequent contributors and new
    contributors.
    -   GitHub has an option,
        ["Dismiss stale pull request approvals when new commits"](https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/defining-the-mergeability-of-pull-requests/managing-a-branch-protection-rule):
        we would likely want to enable it to reduce the weight on reviewers,
        although it means reviewers would need to approve again for any change
        (likely including merge commits).
-   May create issues when a novice contributor breaks something.
    -   There must not be an expectation that novice contributors should
        understand processes, unless demonstrating an understanding becomes a
        prerequisite for review.
