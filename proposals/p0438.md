# Functions

<!--
Part of the Carbon Language project, under the Apache License v2.0 with LLVM
Exceptions. See /LICENSE for license information.
SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
-->

[Pull request](https://github.com/carbon-language/carbon-lang/pull/438)

<!-- toc -->

## Table of contents

-   [Problem](#problem)
-   [Background](#background)
    -   [C++ syntax](#c-syntax)
    -   [Other languages](#other-languages)
    -   [Forward declarations](#forward-declarations)
-   [Proposal](#proposal)
    -   [Functions](#functions)
    -   [Forward declarations](#forward-declarations-1)
-   [Alternatives considered](#alternatives-considered)
    -   [Function keyword](#function-keyword)
    -   [Type](#type)
    -   [`-` (dash)](#--dash)
    -   [`def`](#def)
    -   [`fn`](#fn)
    -   [`fun`](#fun)
    -   [`func`](#func)
    -   [`function`](#function)
    -   [Forward declaration differences with C++](#forward-declaration-differences-with-c)
        -   [Struct and interface methods](#struct-and-interface-methods)
    -   [Rationale](#rationale)

<!-- tocstop -->

## Problem

We currently have
[placeholder guidance on functions](https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/functions.md).
The intent of this proposal is to establish agreement on the basics, providing a
baseline for future evolution.

## Background

### C++ syntax

C++ syntax for function declarations comes in two forms:

```cpp
std::int64_t Sum(std::int64_t a, std::int64_t b) {
  return a + b;
}

// Or with trailing return type syntax:
auto Sum(std::int64_t a, std::int64_t b) -> std::int64_t {
  return a + b;
}
```

Bodies are always wrapped by braces.

### Other languages

To summarize keyword use from other languages:

-   Type: C# and Java
-   `-`: Objective-C
-   `def`: Python and Ruby
-   `fn`: Rust
-   `fun`: Kotlin
-   `func`: Go and Swift
-   `function`: JavaScript, MatLab, PHP, R, and TypeScript

For exhaustive function examples:

-   C#

    ```csharp
    int Sum(int a, int b) {
      return a + b;
    }
    ```

-   Go

    ```go
    func add(a int, b int) int {
      return a + b
    }
    ```

-   Java

    ```java
    Int Sum(Int a, Int b) {
      return a + b;
    }
    ```

-   JavaScript

    ```javascript
    function Sum(a, b) {
        return a + b;
    }
    ```

-   Kotlin

    ```kotlin
    fun add(a: Int, b: Int): Int {
      return a + b
    }
    ```

-   Matlab

    ```matlab
    function s = sum(a,b)
      s = a+b;
    end
    ```

-   Objective-C

    ```objc
    - (int)sum:(int)a
               (int)b {
      return a + b;
    }
    ```

-   PHP

    ```php
    function sum(int $a, int $b) {
      return $a + $b;
    }
    ```

-   Python

    ```python
    def sum(a: int, b:int) -> int:
      return a + b

    def sum(a: int, b:int) -> int:
      return a + b
    ```

-   R

    ```r
    sum <- function(a, b) {
      a + b
    }
    ```

-   Ruby

    ```ruby
    def sum(a, b)
      return a + b
    end
    ```

-   Rust

    ```rust
    fn sum(a: i64, b: i64) -> i64 {
      a + b
    }
    ```

-   Swift

    ```swift
    func sum(a: Int, b: Int) -> Int {
      return a + b
    }
    ```

-   TypeScript

    ```typescript
    function sum(a: number, b: number): number {
        return a + b;
    }
    ```

### Forward declarations

[Forward declarations](https://en.wikipedia.org/wiki/Forward_declaration) of
functions are largely unique to C++. Objective-C also has this. However, most
other languages being discussed do not.

## Proposal

### Functions

Function declarations and definitions should look like:

`<TBD KEYWORD>` _function name_ `(` _arguments_ `)` _[_ `->` _return type_ _]_
`{` _body_ `}`

Arguments should be comma-separated and imitate
[`var` syntax](https://github.com/carbon-language/carbon-lang/pull/339),
although `var` itself is not required.

For example:

```carbon
<TBD KEYWORD> Sum(Int a, Int b) -> Int {
  <body>
}
```

The return type may be omitted if `Void`. For example:

```carbon
<TBD KEYWORD> Print(String s) {
  <body>
}
```

### Forward declarations

Forward declarations will be supported in order to support separation of API and
implementation, as explained in
[code and name organization](https://github.com/carbon-language/carbon-lang/tree/trunk/docs/design/code_and_name_organization).
For example:

```carbon
package Math api;

<TBD KEYWORD> Sum(Int a, Int b) -> Int;
```

Forward declarations will experimentally _only_ be allowed in `api` files, and
_only_ when the definition is in the library's `impl` file. The intent is to
minimize use, consistent with most other languages that have no forward
declaration support at all.

## Alternatives considered

### Function keyword

We may have anchored on `fn` without much consideration. A key piece of this
proposal is to suggest reconsidering the choice, even if we end up with the
same.

### Type

Advantages:

-   Echoes C++, C#, and Java.
-   Simpler to write; a type will often be present for the return regardless.

Disadvantages:

-   Makes function syntax more difficult to parse.
    -   In C++, it's notable that functions with a trailing return still start
        with `auto` to indicate a "type".

There's a consensus that _some_ keyword should be used in order to simplify
parsing, so this option is not expected to receive much support.

### `-` (dash)

Advantages:

-   Echoes Objective-C.
-   This is the most succinct option.

Disadvantages:

-   Easy to miss, and hard to read as a result.

Although this alternative is mentioned, it is not expected to receive much
support due to its readability problem.

### `def`

Advantages:

-   Echoes Python and Ruby.

Disadvantages:

-   `def` is presumably short for "define", which may not be as obvious as a
    "function" derivative.

### `fn`

Advantages:

-   Echoes Rust.
-   The shortest "function" derivative.
    -   Likely comes from the [fn key](https://en.wikipedia.org/wiki/Fn_key).

Disadvantages:

-   Abbreviation by removing letters in the middle of a word is
    [disallowed by Carbon's C++ style](https://google.github.io/styleguide/cppguide.html#General_Naming_Rules).
    -   Even though the abbreviation is in Wikipedia, it is not associated with
        [functions in programming](https://en.wikipedia.org/wiki/Subroutine).
    -   Would likely be the only keyword abbreviated this way.

### `fun`

Advantages:

-   Echoes Kotlin.
-   Could be used with `var` as a push towards three letter abbreviations.
    -   Not clear there are other examples of three letter abbreviations.
    -   `let` may be used in a similar way, although it's not an abbreviation.

Disadvantages:

-   "fun" is a common English word and may be a mildly confusing choice as a
    result.

### `func`

Advantages:

-   Echoes Go and Swift.

Disadvantages:

-   The longest abbreviated form of "function".

### `function`

Advantages:

-   Echoes JavaScript, MatLab, PHP, R, and TypeScript.
-   Clear meaning without any abbreviation.

Disadvantages:

-   The longest "function" derivative.

### Forward declaration differences with C++

This proposal suggests only allowing forward declarations in `api` files where
the corresponding definition is not present.

C++ supports forward declaring functions in a `.cpp` file, and this may be
useful for handling interdependencies between functions. In Carbon, we should
instead aim to allow having a function able to call a function defined later in
the same file without requiring a forward declaration.

Advantages:

-   Minimize accidents with forward declarations not matching implementation.
-   Fewer forward declarations for developers to find while reading.

Disadvantages:

-   Shifts burden onto how code is parsed and executed.

This is proposed as an experiment in order to see if it's sustainable.

#### Struct and interface methods

This is intended to extend to forward declarations of struct and interface to
methods. That is to say, this code is also problematic when the forward
declaration and definition are in the same file:

```carbon
package Geometry impl;

struct Circle {
  <TBD KEYWORD> Print();
};

<TBD KEYWORD> Circle::Print() {
}
```

Instead, either the definition would need to be put inside `Circle`, or
`Circle`'s declaration should be moved to the `api`.

### Rationale

-   This proposal borrows portions of trailing return function syntax from C++.
    -   Although other languages have different trailing return syntax, we
        prefer C++'s syntax given no strong reason to switch.
    -   We prefer trailing return syntax because we expect increased
        readability, and it allows the identifier to be adjacent to TBD KEYWORD.
        It may also simplify the implementation, particularly in cases where the
        return type is defined in terms of the function parameters.
-   Carbon is using TBD KEYWORD for similarity to LANGUAGE(S).
-   Forward declarations are minimized because they hurt readability when used
    excessively.
    -   If we need more forward declarations later, it will be easy to ease
        restrictions.
