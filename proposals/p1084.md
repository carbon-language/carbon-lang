# Generics details 9: forward declarations

<!--
Part of the Carbon Language project, under the Apache License v2.0 with LLVM
Exceptions. See /LICENSE for license information.
SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
-->

[Pull request](https://github.com/carbon-language/carbon-lang/pull/1084)

<!-- toc -->

## Table of contents

-   [Problem](#problem)
-   [Background](#background)
-   [Proposal](#proposal)
-   [Rationale based on Carbon's goals](#rationale-based-on-carbons-goals)
-   [Alternatives considered](#alternatives-considered)
    -   [No `default` keyword on interface members](#no-default-keyword-on-interface-members)
    -   [Declaring an implementation of an incomplete interface](#declaring-an-implementation-of-an-incomplete-interface)
    -   [No implementations for incomplete types](#no-implementations-for-incomplete-types)

<!-- tocstop -->

## Problem

Developers want to organize their code for readability and convenience. For
example, they may want to present the public API of their type in a concise way.
That includes the ability to say a type implements an interface without
repeating the full contents of that interface.

The Carbon compiler can give better diagnostics if it can assume every
identifier it encounters refers to some earlier declaration in the file.
However, sometimes multiple entities will reference each other in a cycle so no
one entity can be defined first.

## Background

We have decided to tackle these problems in a manner similar to C++ by
supporting forward declarations:

-   [issue #472: Open question: Calling functions defined later in the same file](https://github.com/carbon-language/carbon-lang/issues/472)
-   [proposal #875: Principle: information accumulation](https://github.com/carbon-language/carbon-lang/pull/875).

Use of the `default` keyword in `interface` definitions to allow defaulted
members to be defined out-of-line was originally proposed in
[withdrawn proposal #1034](https://github.com/carbon-language/carbon-lang/pull/1034).

## Proposal

This proposal makes changes to these sections of the
[generics details design document](/docs/design/generics/details.md):

-   [Forward declarations and cyclic references](/docs/design/generics/details.md#forward-declarations-and-cyclic-references)
    section added
-   [Interface members with definitions](/docs/design/generics/details.md#interface-members-with-definitions)
    section added to

## Rationale based on Carbon's goals

Forward declarations are intended to advance these goals:

-   [Language tools and ecosystem](/docs/project/goals.md#language-tools-and-ecosystem),
    by making Carbon easier to interpret by code in a single top-down pass.
-   [Code that is easy to read, understand, and write](/docs/project/goals.md#code-that-is-easy-to-read-understand-and-write),
    by allowing developers to separate declaration from definition when
    organizing the presentation of their code, and imposing constraints that
    allow readers to interpret the code with less skipping around.

## Alternatives considered

### No `default` keyword on interface members

Without the `default` keyword, default definitions would always have to be
inline. We discussed this in
[the #syntax channel on Discord](https://discord.com/channels/655572317891461132/709488742942900284/941408009689641010)
which eventually led to the
[question-for-leads issue #1082: Use `default` keyword in interface defaults?](https://github.com/carbon-language/carbon-lang/issues/1082).

The conclusion was that we did want to support forward declarations of default
interface members. To make it so that users would have a single place to look to
see whether the member had a definition even when it might be out of line, we
decided to use a `default` keyword as a prefix of the declaration. We considered
putting the keyword at the end of the declaration, but we decided it was more
readable if it wasn't next to the return type. It was also more consistent with
`final`, an alternative to `default`, which also now supports forward
declaration.

### Declaring an implementation of an incomplete interface

We did not have any use cases for forward declaring an impl of an incomplete
interface, and so we took the conservative position of forbidding that. We could
add this feature in the future if use cases were found, but clearly we can't
have impl definitions until the interface is defined.

### No implementations for incomplete types

For simplicity, generally Carbon entities should either be "incomplete" or
"defined" and never "partially defined". However, the set of interfaces
implemented for a type is by necessity only ever partially known by the nature
of being the
[one static open extension mechanism](https://github.com/carbon-language/carbon-lang/pull/998)
in Carbon. As a result, we felt there was more leeway for implementing
interfaces for incomplete types. This happens incidentally when implementing the
interface inline in the scope of a class definition. We also wanted to allow it
in the case where there was only a forward declaration of the type in an API
file.
