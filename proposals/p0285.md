# if/else

<!--
Part of the Carbon Language project, under the Apache License v2.0 with LLVM
Exceptions. See /LICENSE for license information.
SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
-->

[Pull request](https://github.com/carbon-language/carbon-lang/pull/285)

<!-- toc -->

## Table of contents

-   [Problem](#problem)
-   [Background](#background)
    -   [C++](#c)
    -   [Python](#python)
    -   [Swift](#swift)
    -   [Rust](#rust)
-   [Proposal](#proposal)
-   [Details](#details)
-   [Caveats](#caveats)
    -   [C++ as baseline](#c-as-baseline)
    -   [if/else in expressions](#ifelse-in-expressions)
    -   [Indentation](#indentation)
    -   [Ambiguous else](#ambiguous-else)
-   [Alternatives considered](#alternatives-considered)
    -   [No parentheses](#no-parentheses)
    -   [Require braces](#require-braces)

<!-- tocstop -->

## Problem

if/else is noted in the [language overview](/docs/design/README.md#ifelse), but
is provisional. Control flow is important, and if/else is basic; the form is
similar in many languages, even if details may change.

## Background

if/else is a common
[conditional](<https://en.wikipedia.org/wiki/Conditional_(computer_programming)>),
seen in
[many languages](<https://en.wikipedia.org/wiki/Conditional_(computer_programming)#Choice_system_cross_reference>).
A few syntaxes that are likely to influence `if`/`else` are:

### C++

```cc
if (x) {
  printf("x is true");
} else if (y) {
  printf("y is true");
} else {
  printf("Neither was true");
}
```

### Python

```python
if x:
  print("x is true");
elif y:
  print("y is true");
else:
  print("Neither was true");
```

### Swift

```swift
if x {
  print("x is true")
} else if y {
  print("y is true")
} else {
  print("Neither was true")
}
```

### Rust

Versus other cases where `if` is a statement, Rust makes `if` an expression,
allowing:

```rust
let x = if y {
    1
} else {
    0
};
```

## Proposal

We should make `if`/`else` syntax basically consistent with C/C++, rather than
adopting the syntax of another language.

## Details

`if`/`else` is a statement. The syntax looks like:

if (_boolean expression_) { _statements evaluated when true_ } [ else {
_statements evaluated when false_ } ]

The braces are optional, but must be paired (`{ ... }`) if present.

## Caveats

### C++ as baseline

TODO (need to post a thought-out argument about this to the forums first, but
things like `elif` aren't suggested just because they aren't C++-like)

### if/else in expressions

This proposal covers if/else as a statement. A Rust-like form of if/else as an
expression could be supported, but is not part of this proposal because it's
more complex.

### Indentation

It may be desirable to require meaningful indentation of the body of an
`if`/`else`, in particular to help catch errors when there are no braces.

For example, this could be a compiler error due to inconsistent indentation of
the `do_parse` assignment:

```carbon
if (missing_data)
  Print("Missing data!");
  do_parse = false;
if (do_parse)
  ParseData();
```

This is _not_ part of this proposal.

### Ambiguous else

It may be desirable to reject cases where an `else` is ambiguous. For example,
this could be a compiler error due to the ambiguous `else`:

```carbon
if (a) if (b) f(); else g();
```

This is _not_ part of this proposal. This proposal takes C++ syntax as a
baseline, so an `else` binds to the innermost enclosing `if` that doesn't
already have an `else`.

This desire might also be addressed by choosing to require consistent
indentation and disallowing multiple `if`s on the same line.

## Alternatives considered

Alternatives reflect breaking consistency with C++ syntax, and should be
proposed separately.

### No parentheses

Parentheses could be optional (essentially not part of `if`/`else`, but addable
as part of the expression), instead of required (as proposed).

Advantages:

-   Removing parentheses gives developers less to type.

Disadvantages:

-   Requiring parentheses is consistent with C++, and will be intuitive for C++
    developers, from both a writability and readability perspective.
    -   In C++, adding extra parentheses can be done to disable warnings
-   Parentheses help avoid ambiguities.
    -   The Swift and Rust model is ambiguous if it's ever possible for an
        expression to optionally be followed by braces. That is possible in
        Rust, at least, where `Type{...}` is a valid expression. As a result,
        Rust rejects `if Type{.value = true}.value { thing1 } else { thing2 }`
        because it misinterprets the braces.
-   Parentheses allow making the braces optional without any risk of ambiguity.
-   Parentheses allow introducing syntactic variants in the future without
    ambiguity.
    -   For example, C++'s `if constexpr (...)` wouldn't have been possible if
        the parentheses were optional.

### Require braces

Braces could be required, instead of optional (as proposed).

Advantages:

-   Braces avoid syntax ambiguities.
    -   For example, `if (x) if (y) { ... } else { ... }` has
        difficult-to-understand binding of `else`.
-   Braces avoid errors when adding statements.

    -   For example, if:

        ```
        if (x)
          do_parse = false;
        ```

        has a statement added:

        ```
        if (missing_data)
          Print("Missing data!");
          do_parse = false;
        ```

Disadvantages:

-   Inconsistent with C++.
