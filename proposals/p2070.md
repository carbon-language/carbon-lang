# Always `==` not `=` in `where` clauses

<!--
Part of the Carbon Language project, under the Apache License v2.0 with LLVM
Exceptions. See /LICENSE for license information.
SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
-->

[Pull request](https://github.com/carbon-language/carbon-lang/pull/2070)

<!-- toc -->

## Table of contents

-   [Abstract](#abstract)
-   [Problem](#problem)
-   [Background](#background)
-   [Proposal](#proposal)
-   [Details](#details)
-   [Rationale](#rationale)
-   [Alternatives considered](#alternatives-considered)
    -   [`=` instead of `==`](#-instead-of-)

<!-- tocstop -->

## Abstract

Instead of having two different operators and semantics when constraining an
associated type to be equal to another type variable versus a concrete type,
unify the semantics and consistently use just the `==` operator in `where`
clauses.

## Problem

Having two ways to say two things are constrained to be equal in `where` clauses
had some downsides:

-   Much more likely for users to use the wrong operator, adding a round trip
    through the compiler.
-   Users would have to remember the difference in semantics between the two
    cases.
-   The `=` operator didn't follow the pattern of other `where` constraints,
    which look like boolean expressions returning `true` when the constraint is
    satisfied.

## Background

A `where` clause may used in two situations:

-   to constrain an associated type, see accepted proposal
    [#818: Constraints for generics (generics details 3)](https://github.com/carbon-language/carbon-lang/pull/818),
    and
-   to set the values of associated types in an `impl`, see accepted proposal
    [#1013: Generics: Set associated constants using `where` constraints](https://github.com/carbon-language/carbon-lang/pull/1013).

Proposal #818 considered the alternative of
[using only `==` instead of also `=`](/proposals/p0818.md#using-only--instead-of-also-).
That was not chosen because the `=` and `==` cases were given different (but
similar) semantics.

After #818 was accepted, proposal
[#950](https://github.com/carbon-language/carbon-lang/pull/950) removed some of
the semantic differences. Further, proposal
[#989: Member access expressions](https://github.com/carbon-language/carbon-lang/pull/989)
established how member name lookup was performed in a number of situations,
including for template parameters. Generally speaking, the rule can be
summarized as:

> Look up the given name in all the relevant types and interfaces. If a unique
> name name is found, use it. If more than one name is found, require the user
> to add qualification to disambiguate.

Applying this rule to `where` constraints to remove the semantic difference
between the two forms was discussed:

-   [in the #syntax on Discord](https://discord.com/channels/655572317891461132/709488742942900284/979811441852960808),
    and
-   [during the 2022-06-01 weekly sync meeting](https://docs.google.com/document/d/1dwS2sJ8tsN3LwxqmZSv9OvqutYhP71dK9Dmr1IXQFTs/edit?resourcekey=0-NxBWgL9h05yD2GOR3wUisg#heading=h.qarzfirrcrgf).

## Proposal

The proposal is to use the single `==` syntax, which is more consistent with
other `where` constraint clauses. This syntax would consistently use the same
semantics whether the constraint uses a concrete type or not. In both cases,
when looking up a name in a constrained type variable, the nae will be looked up
using the information from both sides of the `==`. As usual, name conflicts are
resolved by explicit disambiguation.

## Details

The new semantics are described in the
["Satisfying both type-of-types" section](/docs/design/generics/details.md#satisfying-both-type-of-types)
of the
[Generics: Details document at `docs/design/generics/details.md`](/docs/design/generics/details.md).
In addition, references to the old syntax have been updated in:

-   [`docs/design/expressions/arithmetic.md`](/docs/design/expressions/arithmetic.md)
-   [`docs/design/expressions/bitwise.md`](/docs/design/expressions/bitwise.md)
-   [`docs/design/expressions/member_access.md`](/docs/design/expressions/member_access.md)
-   [`docs/design/generics/details.md`](/docs/design/generics/details.md)
-   [`docs/design/generics/overview.md`](/docs/design/generics/overview.md)
-   [`docs/design/generics/terminology.md`](/docs/design/generics/terminology.md)

## Rationale

The new semantics are more consistent with the rest of Carbon, and is simpler.
This directly helps the
["code that is easy to read, understand, and write"](/docs/project/goals.md#code-that-is-easy-to-read-understand-and-write)
goal. In addition, fewer syntactic and semantics constructs, making it easier to
develop
[language tools and ecosystem](/docs/project/goals.md#language-tools-and-ecosystem).

## Alternatives considered

Mainly this proposal is being evaluated against the status quo of the existing
design.

### `=` instead of `==`

We did consider which of `=` and `==` to use. The main advantages of `=` were:

-   it is shorter,
-   it is arguably more natural when defining an implementation, and
-   we found ourselves reaching for `=` more often in examples.

Instead, `==` was chosen for consistency since it looked like a constraint,
since it resulted in a boolean expression like other `where` clauses. `==`
avoids confusion with an initializer after a type expression in `var` or `let`
statement. It also arises with an associated constants that could have a default
value, as in:

```
interface Has2DPoint {
  // Is 2 a default value or part of the `where` constraint?
  let PointT:! NSpacePoint where .N = 2;
}
```
