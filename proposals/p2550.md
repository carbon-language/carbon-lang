# Simplified package declaration for the main package

<!--
Part of the Carbon Language project, under the Apache License v2.0 with LLVM
Exceptions. See /LICENSE for license information.
SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
-->

[Pull request](https://github.com/carbon-language/carbon-lang/pull/2550)

<!-- toc -->

## Table of contents

-   [Abstract](#abstract)
-   [Problem](#problem)
-   [Background](#background)
-   [Proposal](#proposal)
-   [Details](#details)
-   [Rationale](#rationale)
-   [Alternatives considered](#alternatives-considered)
    -   [Give the main package an identifier name](#give-the-main-package-an-identifier-name)
    -   [Distinguish file scope from package scope](#distinguish-file-scope-from-package-scope)
    -   [Keep the package name in imports](#keep-the-package-name-in-imports)

<!-- tocstop -->

## Abstract

Make the preamble of simple programs more ergonomic, by removing the
`package Main` from the main package and removing the `package` declaration
entirely from the main source file. Imports within a single package no longer
need to, and are not permitted to, specify the package name.

## Problem

Every Carbon source file is required to start with a `package` declaration:

```
package Main impl;
```

This introduces complexity and syntactic overhead to very simple programs, such
as might be encountered by beginners learning Carbon.

In addition, imports within a single package are required to restate the name of
the package:

```
package Geometry library "Shapes" api;
import Geometry library "Points";
```

This creates additional syntactic overhead for a common operation, and misses
the opportunity to visually distinguish between different categories of imports
-- "our library" versus "their library". Additionally, under
[#1136](https://github.com/carbon-language/carbon-lang/issues/1136), imports
from the same package have different semantics than imports from a different
package, so giving the two operations the same syntax seems confusing.

Given that every package has an arbitrary, developer-selected identifier name,
it is also unclear how to determine which package contains the entry point of
the program. The name `Main` could be reserved for this, but no such decision
has been made.

## Background

Proposal
[#107: code and name organization](https://github.com/carbon-language/carbon-lang/pull/107/files)
introduced our current `package` syntax.

Issue
[#1869: what is the main entry point for execution?](https://github.com/carbon-language/carbon-lang/issues/1869)
poses the question of how the entry point of a Carbon program is to be found.

In issue
[#1136: what is the top-level scope in a source file, and what names are found there?](https://github.com/carbon-language/carbon-lang/issues/1136),
the leads decided that a package's name should not be injected into the scope of
its files, and that same-package `import`s should not mention the package name.
This change has not been through the proposal process yet.

## Proposal

A Carbon program has a _"main package"_, which is the package that contains the
entry point, assuming the entry point is written in Carbon code. If the main
package contains a function named `Main`, that is the entry point of the
program. Otherwise, the entry point must be supplied in some other way, such as
a `main` function written in C++.

> **Note:** The choice of the name `Main` for the entry point is not part of
> this proposal, and is currently being considered under proposal
> [#2265](https://github.com/carbon-language/carbon-lang/pull/2265).

The package declaration syntax becomes:

-   `package Foo` [`library "Bar"`] \(`api` | `impl`) `;`, unchanged from #107,
    for a file that is part of a package other than the main package.
-   `library "Bar"` (`api` | `impl`) `;` for a library that is part of the main
    package.
-   Omitted entirely for an `impl` file in the main package that is not part of
    a named library.

There is no way to define an `api` file for the main package that is not part of
a named library -- there is no equivalent of `package Main api;`.

The name `Main` is reserved as a package name, and cannot be used within a
program. This allows us to use this name internally for the main package, and
prevents confusion from there being two different interpretations of "the main
package".

The import syntax becomes:

-   `import Foo` [`library "Bar"`] `;` to import package `Foo` library
    `"Bar"`. This introduces the name `Foo` in the current source file as a name
    for that package, containing whatever subset of the package was imported.
    `Foo` is not allowed to be the name of the current package.
-   `import library "Bar";` to import library `"Bar"` of the current package.
    This introduces the names from that library at file scope. `"Bar"` is not
    allowed to be the name of the current library.

There is no way to import libraries from the main package from any other
package.

It is permitted for a Carbon program to contain a source file that has no
`package` declaration and does not contain a `Main` function -- or even to
contain multiple such source files. Such a source file cannot implement any
importable functionality, as there is no corresponding `api` file, but may still
be useful to support Carbon features that have not yet been designed, such as:

-   Global registration mechanisms.
-   Some way of defining functions with well-known symbols, analogous to
    `extern "C"` declarations in C++.

## Details

See design changes.

## Rationale

-   [Community and culture](/docs/project/goals.md#community-and-culture)
    -   This change allows small complete programs and source files to be
        discussed in Carbon forums without the overhead of `package`
        declarations. Cumbersome top-level syntax hampers technical discussion.
-   [Language tools and ecosystem](/docs/project/goals.md#language-tools-and-ecosystem)
    -   Current test cases for `explorer` are made unnecessarily verbose by the
        mandatory inclusion of a `package` declaration and a `Main` function.
        This proposal makes these components optional.
-   [Software and language evolution](/docs/project/goals.md#software-and-language-evolution)
    -   Renaming a package requires changing only the first line of each source
        file, making this operation somewhat easier.
-   [Code that is easy to read, understand, and write](/docs/project/goals.md#code-that-is-easy-to-read-understand-and-write)
    -   Small test cases and `"hello world"` programs have less boilerplate.
    -   Reduction of verbosity that is not contributing to increased
        understanding of the program.
-   [Interoperability with and migration from existing C++ code](/docs/project/goals.md#interoperability-with-and-migration-from-existing-c-code)
    -   This proposal explicitly acknowledges and permits the entry point for a
        program that includes Carbon code to be written in a different language.

## Alternatives considered

### Give the main package an identifier name

We could give the main package an identifier name, such as `Main`, and require
that name to be used in `package` declarations:

```
package Main impl;
import SimpleIO;

fn Main() {
  SimpleIO.Print("Hello, Carbon!");
}
```

This would keep the Carbon language more consistent, and remove a special case.
However, it would also increase verbosity in the simplest of programs, where the
added verbosity has the most cost.

### Distinguish file scope from package scope

Under this proposal, the names from the current package that are visible, either
by being declared locally or by being imported, are visible at the top level
file scope. We could pick a different rule that distinguishes package scope from
file scope, such as by introducing only locally-declared names into file scope
and requiring a `PackageName.` prefix on all other names in the package.

This was discussed at length in
[#1136](https://github.com/carbon-language/carbon-lang/issues/1136). We found
that distinguishing the package from the subset of the package visible at file
scope led to problems that were more substantial than the potential
simplification of treating imports of the current package as being the same as
imports of any other package. See that issue for the full discussion.

### Keep the package name in imports

We could consistently name the package targeted by an import in the `import`
declaration:

```
package Foo api;
import Foo library "Bar";
```

This would lead to a more uniform syntax and, as noted in
[a very similar alternative considered by #107](/proposals/p0107.md#optional-package-names),
would make it easier to search for all imports of a given library with a simple
tool.

There are two reasons to want to avoid this:

-   Use of the same syntax suggests that same-package imports and cross-package
    imports have the same semantics. But they do not: a same-package import
    introduces the set of public names in the nominated library, whereas a
    cross-package import of package `Bar` introduces exactly the name `Bar`.
-   This would require a name for the `Main` package, in order to allow
    libraries of that package to be imported within the same package. Adding
    that name would allow those libraries to also be imported from another
    package, which we wanted to disallow.
